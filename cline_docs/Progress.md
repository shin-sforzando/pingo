# 進捗状況

## 現在の状態

Pingoプロジェクトは現在、機能実装段階に入っています。基礎構築が完了し、ゲーム作成機能、画像投稿機能、ゲームメイン画面の実装が完了しました。

> [!NOTE]
> 詳細な要件や設計の情報については、 `./cline_docs/TechnicalSpecification.md` を参照してください。
> 過去の開発履歴については、 `./cline_docs/Archived_20250514.md` および `./cline_docs/Archived_20250610.md` を参照してください。

## 最近の変更（2025年6月10日）

### ゲームメイン画面の完全実装完了

- ゲームメイン画面ページ（`/game/[gameId]`）の実装
- 画像アップロード→Gemini分析→セル自動更新の統合フロー完成
  - `/api/image/check`エンドポイントの完全書き直し
  - Gemini分析、Submissionレコード作成、セル状態更新を統合
  - 公序良俗チェック + ビンゴセル分析の2段階処理
  - 確信度による自動承認/拒否判定
- SubmissionResult表示問題の解決
  - ImageSubmissionResult型の拡張（Gemini分析結果フィールド追加）
  - 画像プレビュー機能追加（24x24px）
  - アップロード完了後のImageUploadプレビュー自動クリア
- リアルタイム更新機能
  - Firestoreリスナーでプレイヤーボード状態を即座に反映
  - セルOPEN状態の視覚的更新
  - 投稿履歴の自動更新
- エラーハンドリング改善
  - 各API呼び出しで適切なエラーハンドリング
  - インライン表示でユーザーフレンドリーなエラーメッセージ

## 完了済み機能

### ✅ ゲーム作成機能

- ゲーム作成フォーム（タイトル、テーマ、被写体候補）
- Gemini APIによる被写体候補生成・検証
- ビンゴボードプレビュー
- 多言語対応（日英）

### ✅ 画像投稿機能

- ImageUploadコンポーネント（HEIC対応、リサイズ・圧縮）
- Google Cloud Storage連携
- Gemini AI画像内容チェック
- 署名付きURL生成

### ✅ ゲームメイン画面

- ビンゴボード表示
- 画像アップロード機能
- AI判定結果表示
- ゲーム情報・参加者一覧
- リアルタイム更新

### ✅ 基盤機能

- Firebase Authentication
- Firestore データベース
- データアクセス層（Admin Services）
- 多言語対応（next-intl）
- UI コンポーネント（shadcn/ui + Magic UI）

## 次のステップ

### ゲーム参加機能の実装（優先度：最高）

- ゲーム参加フォームの実装
  - QRコード表示機能
  - ゲームID（6桁）入力フォーム
  - 公開かつ有効なゲームの一覧表示
  - 参加確認とプレイヤーボード初期化

### 画像投稿機能の改善（優先度：高）

- 品質保証
  - 残りのAPIエンドポイントのテスト追加
  - エラーケースのテスト強化
  - 統合テストの実装

- 本番対応
  - デバッグログの削除
  - ユーザーフレンドリーなエラーメッセージ
  - パフォーマンス最適化

- セキュリティ強化
  - レート制限の実装
  - ファイル内容の詳細検証
  - APIキーの適切な管理

### その他の機能実装

- 認証・認可の強化
  - 認証済みユーザーのみがアクセスできるページの保護
  - 適切な権限管理

- ユーザビリティ向上
  - エラーメッセージの多言語対応
  - 操作フローの改善
  - レスポンシブデザインの最適化

## 既知の問題

### 認証していないユーザーの対策

ゲーム画面やゲーム作成画面を非認証ユーザーがアクセスできてはいけない

### テストが不十分なファイル

- `src/components/game/ImageUpload.tsx`
- `src/lib/image-utils.ts`
- `src/services/image-upload.ts`
- `src/app/api/image/getUploadUrl/route.ts`
- `src/app/api/image/upload/route.ts`

### 技術的課題

- Storybook 9系へのアップグレード

## アクティブな決定事項

### 画像投稿機能の改善方針

現在の状態: 基本機能は動作するが、本格運用には改善が必要

最優先で修正すべき点:

- critiqueの二か国語対応
  - `critiqueJa` と `critiqueEn` を返すようにして、現在のLocaleに合わせて表示切替
- shadcn/uiのCalendarコンポーネントおよびreact-day-pickerのアップグレード
  - https://ui.shadcn.com/docs/components/calendar#upgrade-guide
- OPEN時、BINGO時の演出の追加
  - OPEN時はMagic UIのConfetti、BINGO時はConfettiのFireworks
  - BINGO列が強調表示されていないバグ

改善が必要な領域:

- テスト品質（自動テスト、エラーケース）
  - テストデータでULIDであるべき場所が適当な値になっている
  - `faker.string.ulid()` を活用せよ
- エラーハンドリング（ユーザーフレンドリーなメッセージ）
- パフォーマンス（処理時間、メモリ使用量）
  - Firestoreの複合インデックスを利用したパフォーマンス改善
- セキュリティ（レート制限、ファイル検証）
- ユーザビリティ（進行状況表示、キャンセル機能）
  - ゲームのメイン画面にアクセスした際、画面を読み込むローディングとユーザのデータを読み込むローディングが行われている
  - 画像投稿時の待ち時間が長いので、適切なローディング表示を行う
- 国際化（エラーメッセージの多言語対応）
- 参加者一覧のビンゴ列数が反映されていない
- 参加者一覧のBadgeが正しく表示されていない
- ゲームメイン画面のStorybookストーリーが存在しない
