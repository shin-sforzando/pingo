# Pingo開発状況と優先タスク

## 現在の開発状況

### ✅ 完了済み機能

- **ゲーム作成**: Gemini AIによる被写体生成を含む完全なフロー
- **画像アップロード**: HEIC対応、リサイズ/圧縮、GCS統合
- **ゲームメイン画面**: ビンゴボード、リアルタイム更新、AI解析
- **認証機能**: Firebase Authによるユーザー管理
- **UI基盤**: shadcn/ui + Magic UIコンポーネント with Storybook
- **国際化対応**: next-intlによる日本語/英語サポート
- **リアルタイム更新**: ゲーム状態のFirestoreリスナー
- **ビンゴライン検出**: 行/列/斜めの自動完了検出
- **参加者管理API**: `/api/game/[gameId]/participants`エンドポイント
- **テストカバレッジ**: 28個のテストファイル、主要APIエンドポイントのテスト実装済み

### ❌ 未完了の重要機能

#### 1. ゲーム参加UI（緊急 - 部分的未実装）

**状況**: APIは存在するがUI層が未実装

- `/game/join`ページが存在しない（404エラー）
- QRコードスキャン機能未実装
- 公開ゲーム一覧表示未実装
- ゲーム参加フロー全体のUI未完成
- **影響**: ユーザーが既存ゲームに参加できない（コア機能の欠陥）

#### 2. セキュリティ・本番対応（高優先度）

- APIエンドポイントのレート制限未実装
- 本番コードにデバッグログが残存
- APIキーのセキュリティレビューが必要
- 入力値検証の改善が必要
- **影響**: セキュリティ脆弱性とスケーラビリティの問題

#### 3. 重要コンポーネントのテスト不足（中優先度）

テストが不足している重要なコンポーネント：

- `src/components/game/ImageUpload.tsx`（テストなし）
- `src/services/image-upload.ts`（テストなし）
- `src/app/api/image/upload/route.ts`（テストなし）
- **影響**: 本番環境での信頼性リスク

## 次スプリントの優先順位

### スプリント1: ゲーム参加UI実装

1. `/game/join`ページの作成（QRスキャン機能付き）
2. ゲーム参加フローのUI実装
3. 公開ゲーム一覧機能の追加
4. エンドツーエンドの参加フローテスト

### スプリント2: セキュリティ強化

1. APIレート制限の実装
2. セキュリティ監査と改善
3. デバッグログの除去
4. エラーハンドリングの改善

### スプリント3: テストカバレッジ完成

1. ImageUploadコンポーネントの包括的テスト追加
2. 画像アップロードサービスとAPIルートのテスト
3. ゲーム参加フローの統合テスト
4. テストカバレッジ70%以上の達成

## 開発コンテキストメモ

### 対象ユーザー

- **モバイルファースト**: スマートフォンが主要プラットフォーム
- **コンテンツポリシー**: ファミリーフレンドリー、全年齢対象
- **言語**: 日本語メイン、英語サブ
- **AI統合**: Google Gemini による画像解析と被写体生成

### 技術的制約

- **モバイル互換性**: iOS Safariでの完璧な動作が必須
- **パフォーマンス目標**:
  - 画像解析: 3秒以内（最大5秒）
  - ページロード: 2秒以内
  - 最大50プレイヤー/ゲーム
  - 最大1,000同時接続ユーザー
- **データ制限**: プレイヤーあたり最大30回の画像投稿/ゲーム

### 開発ワークフローの注意点

- `main`ブランチで直接作業しない
- コミット前に必ず`npm run test:once`を実行
- 全コンポーネントにStorybookストーリーが必要
- 6文字ゲームID以外は全てULIDを使用
- 類似コンポーネントの既存パターンに従う

## 現在の技術仕様

### 最新技術スタック

- **Next.js**: 15.5.3（App Router）
- **React**: 19.1.1
- **TypeScript**: 5系
- **Tailwind CSS**: 4系
- **Firebase**: 12.2.1
- **Google Gemini**: @google/genai 1.19.0

### 開発・テスト環境

- **リンター/フォーマッター**: Biome 2.2.4
- **単体テスト**: Vitest 3.2.4
- **E2Eテスト**: Playwright 1.55.0
- **UI開発**: Storybook 9.1.5
- **Gitフック**: lefthook 1.13.0

### 実装済みAPIエンドポイント

- **認証**: `/api/auth/*`（ログイン、登録、ユーザー管理）
- **ゲーム管理**: `/api/game/create`, `/api/game/[gameId]`
- **参加者管理**: `/api/game/[gameId]/participants`
- **プレイヤーボード**: `/api/game/[gameId]/playerBoard/*`
- **画像投稿**: `/api/game/[gameId]/submission/*`
- **画像解析**: `/api/game/[gameId]/submission/analyze`
- **被写体生成**: `/api/subjects/generate`

## 品質保証状況

### テストカバレッジ現況

- **API routes**: 大部分でテスト実装済み
- **Components**: レイアウトコンポーネント中心にテスト済み
- **Services**: 一部のサービス層でテスト不足
- **E2E**: 基本的なユーザーフローをカバー
